<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Content-Security-Policy" content="
      default-src 'self';
      script-src 'self';
      style-src 'self' 'unsafe-inline';
      img-src 'self' data:;
      connect-src 'self';
      frame-ancestors 'self';
      object-src 'none';
      base-uri 'self';
      upgrade-insecure-requests
    ">
    <link rel="stylesheet" type="text/css" href="hnkstyle.css">
    <title>教師空堂查詢</title>
    <style>
        body { max-width: 1200px; margin: 0 auto; padding: 10px; }
        .container { display: flex; flex-direction: column; gap: 12px; }
        .input-section { display: flex; gap: 10px; align-items: center; background-color: #f5f5f5; padding: 10px; border-radius: 5px; flex-wrap: wrap; }
        .search-section { background-color: #e9f7fe; padding: 10px; border-radius: 5px; margin-top: 10px; }
        .search-options { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 10px; }
        .option-group { display: flex; flex-direction: column; gap: 5px; }
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 10px; }
        .checkbox-item { display: flex; align-items: center; gap: 5px; }
        #teacher-search { padding: 8px; width: 300px; }
    </style>
</head>
<body>
    <div class="refresh-btn" title="重整頁面"><div class="refresh-icon"></div></div>

    <div class="container">
        <h3>教師空堂查詢</h3>
        <div id="loading">載入時間表數據中...</div>

        <div class="input-section">
            <input type="text" id="teacher-search" list="teacher-list" placeholder="輸入教師姓名或從下拉選單選擇">
            <datalist id="teacher-list"></datalist>
            <button id="generateFreePeriods" class="btn">空堂列表</button>
            <div class="checkbox-group" style="margin-top: 0;">
                <div class="checkbox-item">
                    <input type="checkbox" id="s6-finished" name="s6-finished">
                    <label for="s6-finished">中六已完結</label>
                </div>
            </div>
        </div>

        <div id="free-periods-result"></div>
        <div class="table-wrapper">
            <table id="free-periods-table"></table>
        </div>

        <div class="search-section">
            <h2>進階搜尋</h2>
            <div class="search-options">
                <div class="option-group">
                    <h3>星期選擇</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item"><input type="checkbox" id="monday" value="1"><label for="monday">星期一</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="tuesday" value="2"><label for="tuesday">星期二</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="wednesday" value="3"><label for="wednesday">星期三</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="thursday" value="4"><label for="thursday">星期四</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="friday" value="5"><label for="friday">星期五</label></div>
                    </div>
                    <div class="checkbox-group" style="margin-top: 10px;">
                        <div class="checkbox-item"><input type="radio" id="day-or" name="day-operator" value="or" checked><label for="day-or">或 (任一選中星期)</label></div>
                        <div class="checkbox-item"><input type="radio" id="day-and" name="day-operator" value="and"><label for="day-and">和 (所有選中星期)</label></div>
                    </div>
                </div>
                <div class="option-group">
                    <h3>節數選擇</h3>
                    <div class="checkbox-group">
                        ${[...Array(10)].map((_,i)=>`<div class="checkbox-item"><input type="checkbox" id="period${i+1}" value="${i+1}"><label for="period${i+1}">第${i+1}節</label></div>`).join('')}
                    </div>
                    <div class="checkbox-group" style="margin-top: 10px;">
                        <div class="checkbox-item"><input type="radio" id="period-or" name="period-operator" value="or" checked><label for="period-or">或 (任一選中節數)</label></div>
                        <div class="checkbox-item"><input type="radio" id="period-and" name="period-operator" value="and"><label for="period-and">和 (所有選中節數)</label></div>
                    </div>
                </div>
            </div>
            <button id="searchButton" class="btn">搜尋</button>
            <div id="searchResults" class="search-results"></div>
        </div>
    </div>

    <script type="module">
        import { guard } from './js/auth.js';
        import { initRefreshButton } from './js/ui.js';
        import { initFreePeriods } from './free-periods.js';
        guard();
        initRefreshButton();
        initFreePeriods();
    </script>
</body>
</html>